
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lehrmaterial, Übungen, Aufgaben und Hilfen für WebTech">
      
      
      
        <meta name="author" content="Jörn Freiheit">
      
      
        <link rel="canonical" href="http://freiheit.f4.htw-berlin.de/webtech/material/">
      
      <link rel="icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Nutzerverwaltung und Material - WebTech</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#757575">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="grey" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nutzerverwaltung-und-material" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WebTech" class="md-header__button md-logo" aria-label="WebTech" data-md-component="logo">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WebTech
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nutzerverwaltung und Material
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Zurücksetzen" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WebTech" class="md-nav__button md-logo" aria-label="WebTech" data-md-component="logo">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    WebTech
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jfreiheit/webtech/" title="Quellcode" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../einfuehrung/" class="md-nav__link">
        Einführung
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../html/" class="md-nav__link">
        HTML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../css/" class="md-nav__link">
        CSS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rwd/" class="md-nav__link">
        RWD
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../javascript/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../angular/" class="md-nav__link">
        Angular
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../angular2/" class="md-nav__link">
        JSON und Direktiven
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        Routing und Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backend/" class="md-nav__link">
        Backend (MongoDB)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backend_pg/" class="md-nav__link">
        Backend (PostgreSQL)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fe-be-anbindung/" class="md-nav__link">
        Frontend-Backend-Anbindung
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Nutzerverwaltung und Material
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Nutzerverwaltung und Material
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#angular-anwendung-mit-registrierung-und-login" class="md-nav__link">
    Angular-Anwendung mit Registrierung und Login
  </a>
  
    <nav class="md-nav" aria-label="Angular-Anwendung mit Registrierung und Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigation-schematic-nav" class="md-nav__link">
    Navigation schematic - nav
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adress-form-schematic-register-login" class="md-nav__link">
    Adress form schematic - register, login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard-schematic-home" class="md-nav__link">
    Dashboard schematic - home
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-und-appcomponent" class="md-nav__link">
    Routing und AppComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navcomponent" class="md-nav__link">
    NavComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-formular" class="md-nav__link">
    Register-Formular
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    Backend
  </a>
  
    <nav class="md-nav" aria-label="Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passwort-verschlusselung" class="md-nav__link">
    Passwort-Verschlüsselung
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-service-im-frontend" class="md-nav__link">
    Backend-Service im Frontend
  </a>
  
    <nav class="md-nav" aria-label="Backend-Service im Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prufen-ob-e-mail-bereits-registriert" class="md-nav__link">
    Prüfen, ob E-Mail bereits registriert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dialoge-mit-material" class="md-nav__link">
    Dialoge mit Material
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrierung-neue-nutzerin" class="md-nav__link">
    Registrierung neue Nutzerin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    Login
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentisierungs-service" class="md-nav__link">
    Authentisierungs-Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guards-fur-den-komponentenzugriff" class="md-nav__link">
    Guards für den Komponentenzugriff
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dateiupload/" class="md-nav__link">
        Dateiupload
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../promises/" class="md-nav__link">
        Callbacks und Promises
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../uebungen/" class="md-nav__link">
        Übungen
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        Werkzeuge
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#angular-anwendung-mit-registrierung-und-login" class="md-nav__link">
    Angular-Anwendung mit Registrierung und Login
  </a>
  
    <nav class="md-nav" aria-label="Angular-Anwendung mit Registrierung und Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigation-schematic-nav" class="md-nav__link">
    Navigation schematic - nav
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adress-form-schematic-register-login" class="md-nav__link">
    Adress form schematic - register, login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard-schematic-home" class="md-nav__link">
    Dashboard schematic - home
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-und-appcomponent" class="md-nav__link">
    Routing und AppComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navcomponent" class="md-nav__link">
    NavComponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-formular" class="md-nav__link">
    Register-Formular
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    Backend
  </a>
  
    <nav class="md-nav" aria-label="Backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passwort-verschlusselung" class="md-nav__link">
    Passwort-Verschlüsselung
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-service-im-frontend" class="md-nav__link">
    Backend-Service im Frontend
  </a>
  
    <nav class="md-nav" aria-label="Backend-Service im Frontend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prufen-ob-e-mail-bereits-registriert" class="md-nav__link">
    Prüfen, ob E-Mail bereits registriert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dialoge-mit-material" class="md-nav__link">
    Dialoge mit Material
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrierung-neue-nutzerin" class="md-nav__link">
    Registrierung neue Nutzerin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login" class="md-nav__link">
    Login
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentisierungs-service" class="md-nav__link">
    Authentisierungs-Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guards-fur-den-komponentenzugriff" class="md-nav__link">
    Guards für den Komponentenzugriff
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jfreiheit/webtech/edit/master/docs/material.md" title="Seite editieren" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="nutzerverwaltung-und-material">Nutzerverwaltung und Material<a class="headerlink" href="#nutzerverwaltung-und-material" title="Permanent link">&para;</a></h1>
<p>Wir haben bis jetzt immer <a href="https://getbootstrap.com/">Bootstrap</a> als CSS-Framework verwendet. Nun wollen wir stattdessen mal <a href="https://material.angular.io/">Angular Material</a> nutzen. Es sei erwähnt, dass es sogar ein Framework gibt, dass beides vereint, nämlich <a href="https://mdbootstrap.com/">Material Design for Bottstrap (MDB)</a>. Das ist aber nur teilweise kostenlos. </p>
<p>Inhaltlich geht es uns nicht nur um die Verwendung von <em>Angular Material</em>, sondern um eine Nutzer- und Rollenverwaltung, um einige weitere Konzepte anzuwenden, wie z.B. rollenbasierter Zugriff auf Komponenten und die Verschlüsselung und das Prüfen von Passwörtern. </p>
<details><summary>Video aus der Vorlesung am 10.1.2022</summary><p><iframe src="https://mediathek.htw-berlin.de/media/embed?key=02f2878490647c26f0ef9a0267e4ea0d&width=720&height=466&autoplay=false&autolightsoff=false&loop=false&chapters=false&related=false&responsive=false&t=0&loadonclick=true&thumb=true" data-src="https://mediathek.htw-berlin.de/media/embed?key=02f2878490647c26f0ef9a0267e4ea0d&width=720&height=466&autoplay=false&autolightsoff=false&loop=false&chapters=false&related=false&responsive=false&t=0&loadonclick=true" class="" width="720" height="466" frameborder="0" allowfullscreen="allowfullscreen" allowtransparency="true" scrolling="no" aria-label="media embed code" style=""></iframe></p>
</details>
<h2 id="angular-anwendung-mit-registrierung-und-login">Angular-Anwendung mit Registrierung und Login<a class="headerlink" href="#angular-anwendung-mit-registrierung-und-login" title="Permanent link">&para;</a></h2>
<p>Wir erstellen uns dafür eine Angular-Anwendung <code>users</code> mit Routing mit einer Navigations-, einer Registrierungs- und eine Login-Komponente.</p>
<div class="highlight"><pre><span></span><code>ng new users --routing
</code></pre></div>
<p>Wir fügen dieser Anwendung [Angular Material] hinzu:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> users
ng add @angular/material
</code></pre></div>
<p>Sie werden gefragt, welches <code>prebuilt theme</code> Sie verwenden wollen. Nehmen Sie ruhig <code>Custom</code>:</p>
<div class="highlight"><pre><span></span><code>ℹ Using package manager: npm
✔ Found compatible package version: @angular/material@12.2.13.
✔ Package information loaded.

The package @angular/material@12.2.13 will be installed and executed.
Would you like to proceed? Yes
✔ Package successfully installed.
? Choose a prebuilt theme name, or <span class="s2">&quot;custom&quot;</span> <span class="k">for</span> a custom theme: 
  Indigo/Pink        <span class="o">[</span> Preview: https://material.angular.io?theme<span class="o">=</span>indigo-pink <span class="o">]</span> 
  Deep Purple/Amber  <span class="o">[</span> Preview: https://material.angular.io?theme<span class="o">=</span>deeppurple-amber <span class="o">]</span> 
  Pink/Blue Grey     <span class="o">[</span> Preview: https://material.angular.io?theme<span class="o">=</span>pink-bluegrey <span class="o">]</span> 
  Purple/Green       <span class="o">[</span> Preview: https://material.angular.io?theme<span class="o">=</span>purple-green <span class="o">]</span> 
❯ Custom 
</code></pre></div>
<p>und beantworten Sie ruhig alle weiteren Fragen mit <code>y</code>(es):</p>
<div class="highlight"><pre><span></span><code>✔ Package successfully installed.
? Choose a prebuilt theme name, or <span class="s2">&quot;custom&quot;</span> <span class="k">for</span> a custom theme: Custom
? Set up global Angular Material typography styles? Yes
? Set up browser animations <span class="k">for</span> Angular Material? Yes
UPDATE package.json <span class="o">(</span><span class="m">1135</span> bytes<span class="o">)</span>
✔ Packages installed successfully.
CREATE src/custom-theme.scss <span class="o">(</span><span class="m">1416</span> bytes<span class="o">)</span>
UPDATE src/app/app.module.ts <span class="o">(</span><span class="m">502</span> bytes<span class="o">)</span>
UPDATE angular.json <span class="o">(</span><span class="m">3072</span> bytes<span class="o">)</span>
UPDATE src/index.html <span class="o">(</span><span class="m">573</span> bytes<span class="o">)</span>
UPDATE src/styles.css <span class="o">(</span><span class="m">181</span> bytes<span class="o">)</span>
</code></pre></div>
<p>Die Verwendung von <em>Angular Material</em> ist leider etwas aufwendiger, als die von Bootstrap, weil alle Komponenten, die Sie von <em>Angular Material</em> verwenden wollen, explizit in der <code>app.module.ts</code> importiert werden müssen. Wir schauen uns das an einigen Beispielen an. </p>
<h3 id="navigation-schematic-nav">Navigation schematic - nav<a class="headerlink" href="#navigation-schematic-nav" title="Permanent link">&para;</a></h3>
<p>Allerdings hat <em>Angular Material</em> ein recht nützlich Feature, nämlich sogenannte <a href="https://material.angular.io/guide/schematics">Schematics</a>. Das sind vorgefertigte Designkomponenten, die man häufig verwendet. Ein erstes Beispiel für ein solches <em>Schematic</em> ist das <a href="https://material.angular.io/guide/schematics#navigation-schematic">Navigation schematic</a> mit dem wir unsere Navigationskomponente <code>nav</code> erstellen:</p>
<div class="highlight"><pre><span></span><code>ng generate @angular/material:navigation nav
</code></pre></div>
<p>Die allgemeine Syntax zur Erstellung einer Navigationskomponente ist <code>ng generate @angular/material:navigation &lt;component-name&gt;</code>. Wir erzeugen somit also die Komponente namens <code>nav</code>. </p>
<h3 id="adress-form-schematic-register-login">Adress form schematic - register, login<a class="headerlink" href="#adress-form-schematic-register-login" title="Permanent link">&para;</a></h3>
<p>Das <a href="https://material.angular.io/guide/schematics#address-form-schematic">Adress form schematic</a> erzeugt zwar ein Formular für die Eingabe einer Adresse, aber da wir für unser Registrierungs-Formular und auch für das Login-Formular viele CSS-Klassen aus dem Material-Formular verwenden wollen, erzeugen wir uns mithilfe des <a href="https://material.angular.io/guide/schematics#address-form-schematic">Adress form schematic</a> auch die <code>register</code>- und die <code>login</code>-Komponente:</p>
<div class="highlight"><pre><span></span><code>ng generate @angular/material:address-form register
ng generate @angular/material:address-form login
</code></pre></div>
<h3 id="dashboard-schematic-home">Dashboard schematic - home<a class="headerlink" href="#dashboard-schematic-home" title="Permanent link">&para;</a></h3>
<p>Zuletzt verwenden wir noch das <a href="https://material.angular.io/guide/schematics#drag-and-drop-schematic">Dashboard schematic</a>, um uns eine <code>home</code>-Komponente zu erzeugen:</p>
<div class="highlight"><pre><span></span><code>ng generate @angular/material:dashboard home
</code></pre></div>
<h3 id="routing-und-appcomponent">Routing und AppComponent<a class="headerlink" href="#routing-und-appcomponent" title="Permanent link">&para;</a></h3>
<p>Alle drei Komponenten rufen wir zunächst per Routing auf und passen deshalb unsere <code>app-routing.module</code> wie folgt an:</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">app-routing.module.ts</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RouterModule</span><span class="p">,</span> <span class="nx">Routes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">HomeComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./home/home.component&#39;</span><span class="p">;</span>
</span><span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">LoginComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
</span><span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">RegisterComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>
</span>
<span class="hll"><span class="kd">const</span> <span class="nx">routes</span>: <span class="kt">Routes</span> <span class="o">=</span> <span class="p">[{</span>
</span><span class="hll">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class="hll">  <span class="nx">component</span>: <span class="kt">HomeComponent</span>
</span><span class="hll"><span class="p">},</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
</span><span class="hll">  <span class="nx">component</span>: <span class="kt">LoginComponent</span>
</span><span class="hll"><span class="p">},</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span>
</span><span class="hll">  <span class="nx">component</span>: <span class="kt">RegisterComponent</span>
</span><span class="hll"><span class="p">}];</span>
</span>
<span class="kd">@NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">)],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppRoutingModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>In der <code>app.component.html</code> binden wir nur die <code>nav</code>-Komponente ein (<strong>nicht</strong> <code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code> - das kommt in die <code>nav</code>-Komponente):</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">app.component.html</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">app-nav</span><span class="p">&gt;&lt;/</span><span class="nt">app-nav</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
<h3 id="navcomponent">NavComponent<a class="headerlink" href="#navcomponent" title="Permanent link">&para;</a></h3>
<p>Nun passen wir unsere <code>NavComponent</code> an und öffnen dazu die <code>nav.component.html</code>:</p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">app.component.html</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">mat-sidenav-container</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;sidenav-container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-sidenav</span> <span class="err">#</span><span class="na">drawer</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;sidenav&quot;</span> <span class="na">fixedInViewport</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">role</span><span class="err">]=&quot;(</span><span class="na">isHandset</span><span class="err">$</span> <span class="err">|</span> <span class="na">async</span><span class="err">)</span> <span class="err">?</span> <span class="err">&#39;</span><span class="na">dialog</span><span class="err">&#39;</span> <span class="na">:</span> <span class="err">&#39;</span><span class="na">navigation</span><span class="err">&#39;&quot;</span> <span class="err">[</span><span class="na">mode</span><span class="err">]=&quot;(</span><span class="na">isHandset</span><span class="err">$</span> <span class="err">|</span> <span class="na">async</span><span class="err">)</span> <span class="err">?</span> <span class="err">&#39;</span><span class="na">over</span><span class="err">&#39;</span> <span class="na">:</span> <span class="err">&#39;</span><span class="na">side</span><span class="err">&#39;&quot;</span> <span class="err">[</span><span class="na">opened</span><span class="err">]=&quot;(</span><span class="na">isHandset</span><span class="err">$</span> <span class="err">|</span> <span class="na">async</span><span class="err">)</span> <span class="err">===</span> <span class="na">false</span><span class="err">&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-toolbar</span><span class="p">&gt;</span>Menu<span class="p">&lt;/</span><span class="nt">mat-toolbar</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-nav-list</span><span class="p">&gt;</span>
<span class="hll">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">mat-list-item</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]=&quot;&#39;/&#39;&quot;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">mat-list-item</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]=&quot;&#39;/</span><span class="na">register</span><span class="err">&#39;&quot;</span><span class="p">&gt;</span>Register<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">mat-list-item</span> <span class="err">[</span><span class="na">routerLink</span><span class="err">]=&quot;&#39;/</span><span class="na">login</span><span class="err">&#39;&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span><span class="hll">        <span class="p">&lt;/</span><span class="nt">mat-nav-list</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;/</span><span class="nt">mat-sidenav</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-sidenav-content</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-toolbar</span> <span class="na">color</span><span class="o">=</span><span class="s">&quot;primary&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Toggle sidenav&quot;</span> <span class="na">mat-icon-button</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">drawer</span><span class="err">.</span><span class="na">toggle</span><span class="err">()&quot;</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;isHandset$ | async&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-icon</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Side nav toggle icon&quot;</span><span class="p">&gt;</span>menu<span class="p">&lt;/</span><span class="nt">mat-icon</span><span class="p">&gt;</span>
                  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="hll">            <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>Nutzer- und Rollenverwaltung<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span>        <span class="p">&lt;/</span><span class="nt">mat-toolbar</span><span class="p">&gt;</span>
        <span class="c">&lt;!-- Add Content Here --&gt;</span>
<span class="hll">        <span class="p">&lt;</span><span class="nt">router-outlet</span><span class="p">&gt;&lt;/</span><span class="nt">router-outlet</span><span class="p">&gt;</span>
</span>    <span class="p">&lt;/</span><span class="nt">mat-sidenav-content</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">mat-sidenav-container</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Wichtig ist, dass die <code>&lt;router-outlet&gt;&lt;/router-outlet&gt;</code> an die Stelle des Kommentars <code>&lt;!-- Add Content Here --&gt;</code> kommt (Zeile <code>18</code>). Genau dort wird der Inhalt eingebunden, d.h. die Komponenten, die per Routing aufgerufen und eingebunden werden (bei uns <code>home</code>, <code>register</code> oder <code>login</code>). Der Eintrag in Zeile <code>15</code> ist wie eine Überschrift und in den Zeilen <code>5-8</code> werden die Menüeinträge (und die dazugehörigen Routen) definiert. Es entsteht folgende  (für die <code>home</code>-Komponente):</p>
<p><img alt="material" src="../files/235_material.png" /></p>
<p>Verrringern Sie auch die Breite des Viewports, um zu sehen, wie responsive die einzelnen Komponenten (inkl. <code>nav</code>-Komponente) bereits sind. </p>
<h3 id="register-formular">Register-Formular<a class="headerlink" href="#register-formular" title="Permanent link">&para;</a></h3>
<p>Wir passen nun das Formular zur Registrierung an. Das Standard-Shipping-Adress-Formular zeigt, was mit Formularen im <em>Material-Design</em>  alles möglich ist. Wir passen das Formular an, um die Registrierung einer Nutzerin mit ihrer Rolle zu ermöglichen:</p>
<div class="tabbed-set" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">register.component.html</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&quot;</span><span class="na">registerForm</span><span class="err">&quot;</span> <span class="na">novalidate</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)=&quot;</span><span class="na">onSubmit</span><span class="err">()&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-card</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;shipping-card&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-header</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">mat-card-title</span><span class="p">&gt;</span>Registrierung<span class="p">&lt;/</span><span class="nt">mat-card-title</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-header</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-content</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Vorname<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Vorname&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;firstName&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;registerForm.controls[&#39;firstName&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
                        Vorname <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>erforderlich<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Nachname<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Nachname&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;lastName&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;registerForm.controls[&#39;lastName&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
                        Nachname <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>erforderlich<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>E-Mail<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;E-Mail&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;registerForm.controls[&#39;email&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
                        E-mail <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>erforderlich<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Passwort<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Passwort&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="err">[</span><span class="na">type</span><span class="err">]=&quot;</span><span class="na">hide</span> <span class="err">?</span> <span class="err">&#39;</span><span class="na">password</span><span class="err">&#39;</span> <span class="na">:</span> <span class="err">&#39;</span><span class="na">text</span><span class="err">&#39;&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-icon-button</span> <span class="na">matSuffix</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">hide </span><span class="o">=</span> <span class="s">!hide&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-label</span><span class="err">]=&quot;&#39;</span><span class="na">Hide</span> <span class="na">password</span><span class="err">&#39;&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-pressed</span><span class="err">]=&quot;</span><span class="na">hide</span><span class="err">&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">mat-icon</span><span class="p">&gt;</span>{{hide ? &#39;visibility_off&#39; : &#39;visibility&#39;}}<span class="p">&lt;/</span><span class="nt">mat-icon</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Passwort wiederholen<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Passwort wiederholen&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;passwordrepeat&quot;</span> <span class="err">[</span><span class="na">type</span><span class="err">]=&quot;</span><span class="na">hide</span> <span class="err">?</span> <span class="err">&#39;</span><span class="na">password</span><span class="err">&#39;</span> <span class="na">:</span> <span class="err">&#39;</span><span class="na">text</span><span class="err">&#39;&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-icon-button</span> <span class="na">matSuffix</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">hide </span><span class="o">=</span> <span class="s">!hide&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-label</span><span class="err">]=&quot;&#39;</span><span class="na">Hide</span> <span class="na">password</span><span class="err">&#39;&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-pressed</span><span class="err">]=&quot;</span><span class="na">hide</span><span class="err">&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">mat-icon</span><span class="p">&gt;</span>{{hide ? &#39;visibility_off&#39; : &#39;visibility&#39;}}<span class="p">&lt;/</span><span class="nt">mat-icon</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Rolle<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-select</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Rolle&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;role&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">mat-option</span> <span class="err">*</span><span class="na">ngFor</span><span class="o">=</span><span class="s">&quot;let role of roles&quot;</span> <span class="err">[</span><span class="na">value</span><span class="err">]=&quot;</span><span class="na">role</span><span class="err">.</span><span class="na">abbreviation</span><span class="err">&quot;</span><span class="p">&gt;</span>
                            {{ role.name }}
                        <span class="p">&lt;/</span><span class="nt">mat-option</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-select</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-hint</span> <span class="na">align</span><span class="o">=</span><span class="s">&quot;end&quot;</span><span class="p">&gt;</span>Wählen Sie eine Rolle<span class="p">&lt;/</span><span class="nt">mat-hint</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;registerForm.controls[&#39;role&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
                        State is <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>required<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-content</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-actions</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-raised-button</span> <span class="na">color</span><span class="o">=</span><span class="s">&quot;primary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Registrieren<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-actions</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">mat-card</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
<div class="tabbed-set" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">register.component.ts</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AbstractControl</span><span class="p">,</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">ValidationErrors</span><span class="p">,</span> <span class="nx">ValidatorFn</span><span class="p">,</span> <span class="nx">Validators</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>

<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-register&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./register.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./register.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RegisterComponent</span> <span class="p">{</span>
  <span class="nx">hide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nx">checkPasswords</span>: <span class="kt">ValidatorFn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">group</span>: <span class="kt">AbstractControl</span><span class="p">)</span><span class="o">:</span>  <span class="nx">ValidationErrors</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">pass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="o">?</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">confirmPass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="o">?</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;passwordrepeat&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span>
    <span class="k">return</span> <span class="nx">pass</span> <span class="o">===</span> <span class="nx">confirmPass</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">notSame</span>: <span class="kt">true</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">registerForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
    <span class="nx">firstName</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">lastName</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">email</span><span class="p">]],</span>
    <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">compose</span><span class="p">([</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$&#39;</span><span class="p">),</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">minLength</span><span class="p">(</span><span class="mf">8</span><span class="p">),</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">(</span><span class="mf">20</span><span class="p">)])</span>
    <span class="p">],</span>
    <span class="nx">passwordrepeat</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">],</span>
    <span class="nx">role</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
  <span class="p">},</span> <span class="p">{</span> <span class="nx">validators</span>: <span class="kt">this.checkPasswords</span> <span class="p">});</span>

  <span class="nx">roles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Admin&#39;</span><span class="p">,</span> <span class="nx">abbreviation</span><span class="o">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nx">abbreviation</span><span class="o">:</span> <span class="s1">&#39;user&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">fb</span>: <span class="kt">FormBuilder</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Registrierung erfolgreich!&#39;</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<div class="tabbed-set" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><label for="__tabbed_6_1">register.component.css</label><div class="tabbed-content"></div>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">mat-card</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">%</span> <span class="mi">20</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">full-width</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Es entsteht folgendes Formular:</p>
<p><img alt="material" src="../files/236_material.png" /></p>
<h2 id="backend">Backend<a class="headerlink" href="#backend" title="Permanent link">&para;</a></h2>
<p>Wir erweiteren das <a href="../backend/#rest-api-mongodb">Backend</a>, das wir für die Verwaltung von <code>Member</code>-Einträgen in die MongoDB erstellt hatten. Wir führen entsprechende Erweiterungen durch. Der Verzeichnisbaum im Projekt sieht nun so aus:</p>
<p><img alt="user" src="../files/237_user.png" /></p>
<p>Es wurde also ein <code>models</code>-Verzeichnis erstellt, in dem sowohl die <code>members.js</code> (also das Model für die <code>Members</code>) als auch das neue <code>users.js</code> enthalten ist. Ebenso wurden die Dateien <code>members.js</code> und <code>users.js</code> in dem Verzeichnis <code>routes</code> erstellt, in dem die jeweiligen Routen für die <code>Users</code> und die <code>Members</code> definiert sind. </p>
<p>Die <code>server.js</code> sieht nun so aus:</p>
<div class="tabbed-set" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><label for="__tabbed_7_1">server.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./db&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">routesMembers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/members&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">routesUsers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/users&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">initDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./initdb&#39;</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mf">3000</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="c1">// enable cors for all requests</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/initdb&#39;</span><span class="p">,</span> <span class="nx">initDB</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span> <span class="nx">routesMembers</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="nx">routesUsers</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ... `</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Die <code>db.js</code> hat folgendes Aussehen:</p>
<div class="tabbed-set" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><label for="__tabbed_8_1">db.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>

<span class="c1">// connect to mongoDB</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_CONNECTION</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
        <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;connected to DB&#39;</span><span class="p">);</span> <span class="p">},</span>
        <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;connection error:&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">);</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>und im <code>.env</code>-File ist nur </p>
<div class="highlight"><pre><span></span><code><span class="nv">DB_CONNECTION</span> <span class="o">=</span> mongodb://127.0.0.1:27017/members 
</code></pre></div>
<p>hinterlegt. Die in der <code>server.js</code> definierte Route <code>/initdb</code> bewirkt den Aufruf von <code>initdb.js</code>, die die <code>members</code>-Collection befüllt. Das kann aber auch weggelassen werden - oder Sie erweitern das Skript noch um eigene Einträge für die <code>users</code>-Collection:</p>
<details><summary>initdb.js</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kd">const</span> <span class="p">{</span>
    <span class="nx">Members</span><span class="p">,</span>
    <span class="nx">Users</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./models/users&#39;</span><span class="p">);</span>

<span class="c1">// create collection members</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">Members</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">([{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Catherine&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Williams&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;cwilliamsl@360.cn&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Adam&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Anderson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;aanderson8@google.fr&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Susan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Andrews&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;sandrewsn@google.co.jp&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Catherine&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Andrews&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;candrewsp@noaa.gov&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Alan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Bradley&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;abradley1c@globo.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Anne&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Brooks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;abrooks16@bravesites.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Russell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Brown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rbrownq@nifty.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Ryan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Burton&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rburton18@foxnews.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Roy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Campbell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rcampbell1@geocities.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Russell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Campbell&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rcampbell17@eventbrite.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Bonnie&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Coleman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;bcoleman11@fc2.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Ernest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Coleman&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;ecoleman15@businessweek.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Richard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Cruz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rcruz7@unc.edu&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Sean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Cruz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;scruz10@answers.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Rebecca&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Cunningham&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rcunninghamd@mac.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Margaret&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Evans&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mevansh@pcworld.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Jeffrey&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;jford14@cnet.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Andrea&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Gardner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;agardnerv@woothemes.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Deborah&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;George&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;dgeorge6@furl.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Sean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Gibson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;sgibsony@alexa.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Virginia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Graham&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;vgrahamk@aol.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Steven&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Hamilton&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;shamiltonu@state.tx.us&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Virginia&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Hawkins&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;vhawkinsf@ehow.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Edward&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Hicks&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;ehicksc@pcworld.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Mark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Johnson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mjohnsonj@hostgator.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Ruth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Jordan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rjordan1a@smugmug.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Antonio&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Kim&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;akim4@odnoklassniki.ru&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Jennifer&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Marshall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;jmarshallt@gnu.org&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Eric&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Matthews&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;ematthews5@independent.co.uk&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Raymond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Mcdonald&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;rmcdonald2@ihg.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Eric&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Miller&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;emillere@creativecommons.org&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Jonathan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Morales&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;jmoralesa@ovh.net&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Marie&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Morgan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mmorganb@cloudflare.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Amanda&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Nelson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;anelson13@indiatimes.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Lisa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Olson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;lolsonr@telegraph.co.uk&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Ortiz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;aortizw@histats.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Peter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Phillips&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;pphillipss@1688.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Matthew&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Porter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mporter9@europa.eu&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Tammy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Ray&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;trayx@weather.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Mark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Richardson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mrichardson1d@ihg.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Joan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Roberts&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;jroberts12@alibaba.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Kathleen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Rose&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;kroseg@pinterest.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Steve&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Sanders&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;ssanders1b@wikispaces.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Shirley&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Scott&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;sscottm@macromedia.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Lillian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Stephens&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;lstephens19@hugedomains.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Nicole&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Thompson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;nthompson3@admin.ch&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Marie&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Thompson&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mthompsonz@yelp.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Alan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Vasquez&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;avasquezo@miibeian.gov.cn&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Mildred&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Watkins&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;mwatkins0@miibeian.gov.cn&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;forename&quot;</span><span class="o">:</span> <span class="s2">&quot;Eugene&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surname&quot;</span><span class="o">:</span> <span class="s2">&quot;Williams&quot;</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;ewilliamsi@deliciousdays.com&quot;</span>
        <span class="p">}</span>
    <span class="p">])</span>
    <span class="kd">const</span> <span class="nx">allMembers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Members</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">allMembers</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">allMembers</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
</details>
<p>Die beiden <code>models</code> sind wie folgt definiert:</p>
<div class="tabbed-set" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><label for="__tabbed_9_1">models/users.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>

<span class="c1">// users Schema</span>
<span class="kd">const</span> <span class="nx">usersSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">firstname</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">lastname</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">role</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">});</span>

<span class="c1">// Exporting our model objects</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nx">usersSchema</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
</div>
<input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><label for="__tabbed_9_2">models/members.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">forename</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">surname</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Member&#39;</span><span class="p">,</span> <span class="nx">schema</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>An dem <code>routes/members.js</code> haben wir nichts geändert:</p>
<details><summary>routes/members.js</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">Member</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/members&#39;</span><span class="p">);</span>

<span class="c1">// get all members</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">allMembers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Member</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">allMembers</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">allMembers</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// post one member</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newMember</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Member</span><span class="p">({</span>
        <span class="nx">forename</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">forename</span><span class="p">,</span>
        <span class="nx">surname</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">surname</span><span class="p">,</span>
        <span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span>
    <span class="p">})</span>
    <span class="k">await</span> <span class="nx">newMember</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">newMember</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// get one member via id</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">member</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Member</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">});</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">member</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;Member does not exist!&quot;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// update one member via id</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">member</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Member</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">})</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">forename</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">member</span><span class="p">.</span><span class="nx">forename</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">forename</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">surname</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">member</span><span class="p">.</span><span class="nx">surname</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">surname</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">member</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span>
        <span class="p">}</span>

        <span class="k">await</span> <span class="nx">Member</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span> <span class="nx">member</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">member</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;Member does not exist!&quot;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// delete one member via id</span>
<span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">Member</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">204</span><span class="p">).</span><span class="nx">send</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;Member does not exist!&quot;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
</details>
<p>Das Skript <code>routes/users.js</code> ist prinzipiell gleich aufgebaut, wie das <code>members.js</code>-Skript, denn auch dort sollen die <code>CRUD</code>-Funktionen abgebildet werden, allerdings kommt noch die Verschlüsselung von Passwörtern hinzu.</p>
<h3 id="passwort-verschlusselung">Passwort-Verschlüsselung<a class="headerlink" href="#passwort-verschlusselung" title="Permanent link">&para;</a></h3>
<p>Die Passwörter sollen nur verschlüsselt in der Datenbank abgelegt werden. Dazu verwenden wir das Paket <a href="https://www.npmjs.com/package/bcrypt">bcrypt</a>.</p>
<div class="highlight"><pre><span></span><code>npm install bcrypt
</code></pre></div>
<p>Beim Einfügen eines neuen <code>User</code>-Eintrags wird das übermittelte Passwort verschlüsselt, bevor es in die Datenbank gespeichert wird:</p>
<div class="tabbed-set" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><label for="__tabbed_10_1">routes/users.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../models/users&#39;</span><span class="p">);</span>
<span class="hll"><span class="kd">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bcrypt&#39;</span><span class="p">);</span>
</span>
<span class="c1">// get all users</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">allUsers</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">allUsers</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">allUsers</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// post one user</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="hll">    <span class="kd">const</span> <span class="nx">saltRounds</span> <span class="o">=</span> <span class="mf">10</span><span class="p">;</span>
</span><span class="hll">    <span class="kd">let</span> <span class="nx">pwHash</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class="hll">    <span class="k">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">genSalt</span><span class="p">(</span><span class="nx">saltRounds</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">salt</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="p">(</span><span class="nx">errHash</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">pwHash</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">;</span>
</span><span class="hll">            <span class="kd">const</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span>
</span><span class="hll">                <span class="nx">firstname</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">lastname</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">password</span><span class="o">:</span> <span class="nx">pwHash</span><span class="p">,</span>
</span><span class="hll">                <span class="nx">role</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">role</span>
</span><span class="hll">            <span class="p">});</span>
</span><span class="hll">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;newUser&#39;</span><span class="p">,</span> <span class="nx">newUser</span><span class="p">);</span>
</span><span class="hll">            <span class="nx">newUser</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</span><span class="hll">            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span>
<span class="p">});</span>

<span class="c1">// get one user via email and password</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/login/:email&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">email</span> <span class="p">});</span>
<span class="hll">        <span class="kd">let</span> <span class="nx">sendPw</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
</span><span class="hll">        <span class="kd">let</span> <span class="nx">userPW</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
</span><span class="hll">        <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">sendPw</span><span class="p">,</span> <span class="nx">userPW</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Passwort korekt!&#39;</span><span class="p">);</span>
</span><span class="hll">                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
</span><span class="hll">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="hll">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;falsches Passwort!&#39;</span><span class="p">);</span>
</span><span class="hll">                <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">403</span><span class="p">);</span>
</span><span class="hll">                <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span class="hll">                    <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;Wrong password!&quot;</span>
</span><span class="hll">                <span class="p">});</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="p">});</span>
</span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;User does not exist!&quot;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// get one user via username</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:email&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">email</span> <span class="p">});</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;User does not exist!&quot;</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// update one user via id</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;/:email&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">email</span> <span class="p">})</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">user</span><span class="p">.</span><span class="nx">role</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">role</span>
        <span class="p">}</span>

        <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">email</span> <span class="p">},</span> <span class="nx">user</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;User does not exist!&quot;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// delete one user via id</span>
<span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/:id&#39;</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">email</span> <span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">204</span><span class="p">).</span><span class="nx">send</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">error</span><span class="o">:</span> <span class="s2">&quot;User does not exist!&quot;</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>    
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wird ein neuer Eintrag in die Datenbank geschrieben (ab Zeile <code>13</code>), wird das Passwort mithilfe der <code>hash</code>-Funktion von <code>bcrypt</code> verschlüsselt. Dieser Passwort-Hash (siehe Zeilen <code>19</code> und <code>24</code>) werden gespeichert. </p>
<p>Von der <code>GET</code>-Anfrage für einen <code>user</code> gibt es zwei Routen. Die Route <code>router.get('/:email',...)</code> gibt den Eintrag einer <code>user</code>in für eine übergebene <code>:email</code> zurück. Dieser Eintrag enthält das Passwort als <code>hash</code>-Wert. Die Route <code>router.post('/login/:email', ...)</code> erwartet im <code>body</code> noch ein Passwort. Deshalb wird hier auch die <code>POST</code>-Anfragemethode verwendet. Es wird überprüft, ob das übergebene Passwort dem gespeicherten Passwort entspricht. Dies geschieht mithilfe der <code>compare</code>-Funktion von <code>bcrypt</code> (siehe Zeile <code>41</code>). </p>
<p>Angenommen, es wird folgender Datensatz gepostet:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
        <span class="nt">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;test1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;lastname&quot;</span><span class="p">:</span> <span class="s2">&quot;test1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test1@htw-berlin.de&quot;</span><span class="p">,</span>
        <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;test1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><img alt="user" src="../files/238_user.png" /> </p>
<p>Dann wird ein Datensatz in die Datenbank gespeichert, der das <em>gehashte</em> Passwort enthält (bei Ihnen wird das Passwort und die <code>_id</code> jeweils anders sein):</p>
<p><img alt="user" src="../files/239_user.png" /> </p>
<p>Die Anfrage <code>GET http://localhost:3000/users/test1@htw-berlin.de</code> liefert entsprechend das Objekt zurück:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;61d2be50e101156611d31025&quot;</span><span class="p">,</span>
    <span class="nt">&quot;firstname&quot;</span><span class="p">:</span> <span class="s2">&quot;test1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lastname&quot;</span><span class="p">:</span> <span class="s2">&quot;test1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;test1@htw-berlin.de&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;$2b$10$WoinjWBRiTmYe2lZED260euref2ieSPYhScHBUs./kpZZKXm06p.m&quot;</span><span class="p">,</span>
    <span class="nt">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span><span class="p">,</span>
    <span class="nt">&quot;__v&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>
<p>Bei der Anfrage <code>POST http://localhost:3000/users/login/test1@htw-berlin.de</code> muss im <code>Body</code> des <code>Request</code> auch noch ein Passwort übergeben werden:</p>
<p><img alt="user" src="../files/240_user.png" style="width:70%" /></p>
<p>Nur, wenn das Passwort korrekt ist, wird das Objekt gesendet, ansonsten wird ein Fehlerobjekt versendet:</p>
<p><img alt="user" src="../files/241_user.png" style="width:50%" /></p>
<h2 id="backend-service-im-frontend">Backend-Service im Frontend<a class="headerlink" href="#backend-service-im-frontend" title="Permanent link">&para;</a></h2>
<p>Zur Anbindung an die oben beschriebene REST-API erstellen wir im Frontend einen Service</p>
<div class="highlight"><pre><span></span><code>ng g s shared/backend
</code></pre></div>
<p>Diesen Service implementieren wir, wie <a href="../fe-be-anbindung/#service-fur-http">hier</a> beschrieben. Das bedeutet, dass wir zunächst das <code>HttpClientModule</code> in der <code>app.module.ts</code> importieren:</p>
<details><summary>app.module.ts</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">AppRoutingModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app-routing.module&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserAnimationsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser/animations&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NavComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./nav/nav.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LayoutModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/cdk/layout&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatToolbarModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/toolbar&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatButtonModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/button&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatSidenavModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/sidenav&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatIconModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/icon&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatListModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/list&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RegisterComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatInputModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/input&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatSelectModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/select&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatRadioModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/radio&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatCardModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/card&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ReactiveFormsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LoginComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HomeComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./home/home.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatGridListModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/grid-list&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatMenuModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/menu&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
</span>
<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span><span class="p">,</span>
    <span class="nx">NavComponent</span><span class="p">,</span>
    <span class="nx">RegisterComponent</span><span class="p">,</span>
    <span class="nx">LoginComponent</span><span class="p">,</span>
    <span class="nx">HomeComponent</span>
  <span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">AppRoutingModule</span><span class="p">,</span>
    <span class="nx">BrowserAnimationsModule</span><span class="p">,</span>
    <span class="nx">LayoutModule</span><span class="p">,</span>
    <span class="nx">MatToolbarModule</span><span class="p">,</span>
    <span class="nx">MatButtonModule</span><span class="p">,</span>
    <span class="nx">MatSidenavModule</span><span class="p">,</span>
    <span class="nx">MatIconModule</span><span class="p">,</span>
    <span class="nx">MatListModule</span><span class="p">,</span>
    <span class="nx">MatInputModule</span><span class="p">,</span>
    <span class="nx">MatSelectModule</span><span class="p">,</span>
    <span class="nx">MatRadioModule</span><span class="p">,</span>
    <span class="nx">MatCardModule</span><span class="p">,</span>
    <span class="nx">ReactiveFormsModule</span><span class="p">,</span>
    <span class="nx">MatGridListModule</span><span class="p">,</span>
    <span class="nx">MatMenuModule</span><span class="p">,</span>
<span class="hll">    <span class="nx">HttpClientModule</span>
</span>  <span class="p">],</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</details>
<p>Im <code>BackendService</code> implementieren wir zunächst zwei Funktionen:</p>
<ul>
<li><code>registerNewUser(user: User)</code> legt einen neuen <code>User</code> in der Datenbank an, d.h. der Endpunkt <code>POST http://localhost:3000/users</code> wird aufgerufen und die neuen <code>User</code>-Daten im <code>Body</code> des Requests übergeben,</li>
<li><code>checkIfExist(email: string)</code> prüft, ob die <code>email</code> bereits registriert ist, d.h. der Endpunkt <code>POST http://localhost:3000/users/:email</code> wird aufgerufen.</li>
</ul>
<div class="tabbed-set" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><label for="__tabbed_11_1">shared/backend.service.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClient</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">BackendService</span> <span class="p">{</span>
  <span class="nx">userRoute</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:3000/users&#39;</span><span class="p">;</span>
  <span class="nx">memberRoute</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:3000/members&#39;</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">http</span><span class="o">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">registerNewUser</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span> <span class="nx">User</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userRoute</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">checkIfExist</span><span class="p">(</span><span class="nx">email</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userRoute</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">email</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<h3 id="prufen-ob-e-mail-bereits-registriert">Prüfen, ob E-Mail bereits registriert<a class="headerlink" href="#prufen-ob-e-mail-bereits-registriert" title="Permanent link">&para;</a></h3>
<p>Wird eine neue E-Mail eingegeben, dann soll zunächst geprüft werden, ob diese bereits registriert ist. Dazu wird nicht erst das gesamte Formular <em>submitted</em>, sondern wir behandeln für das Eingabefeld der E-Mail direkt das <code>change</code>-Ereignis. Das <code>change</code>-Ereignis wird ausgelöst, nachdem die Eingabe im Eingabefeld abgeschlossen ist (d.h. entweder die <code>Enter</code>-taste gedrückt wird oder der Fokus vom Eingaefeld auf ein anderes Eingabefeld wechselt). Soll jede Tastatureingabe behandelt werden, bietet sich dafür das <code>input</code>-Ereignis an. Wir fügen hier die Behandlung des <code>change</code>-Ereignisses hinzu: </p>
<div class="tabbed-set" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><label for="__tabbed_12_1">Ausschnitt aus register.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>E-Mail<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;E-Mail&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="err">(</span><span class="na">change</span><span class="err">)=&quot;</span><span class="na">checkIfExists</span><span class="err">($</span><span class="na">event</span><span class="err">.</span><span class="na">target</span><span class="err">)&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;registerForm.controls[&#39;email&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
            E-Mail <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>erforderlich<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Neu ist darin also der Eintrag <code>(change)="checkIfExists($event.target)"</code>. Mithilfe der Funktion <code>checkIfExists()</code> soll also geprüft werden, ob die E-Mail-Adresse bereits in der Datenbank gespeichert ist. Der Funktion wird <code>$event.target</code> übergeben. Das ist das auslösende <code>input</code>-Element. </p>
<p>Die <code>checkIfExists()</code>-Funktion wird in der <code>register.component.ts</code> definiert:</p>
<div class="tabbed-set" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><label for="__tabbed_13_1">Ausschnitt aus register.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="nx">checkIfExists</span><span class="p">(</span><span class="nx">evt</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">email</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;event-target&#39;</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">email</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bs</span><span class="p">.</span><span class="nx">checkIfExist</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">openDialog</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>
      <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Die <code>email</code> selbst wird als <code>value</code> aus dem <code>input</code>-Element ausgelesen (Zeile <code>77</code>). Die Konsoleausgaben können natürlich auch weg. In Zeile <code>80</code> wird die <code>checkIfExist()</code>-Funktion des <code>BackendService</code> aufgerufen. Dieser muss per <em>dependency injection</em> eingebunden werden. Wenn als <code>response</code> ein Objekt zurückgesendet wird, dann existiert die E-Mail-Adresse bereits. Dann soll ein <em>modaler Dialog</em>  geöffnet werden, der dies anzeigt. Diese <code>openDialog()</code>-Funktion soll im Folgenden erstellt werden. </p>
<h3 id="dialoge-mit-material">Dialoge mit Material<a class="headerlink" href="#dialoge-mit-material" title="Permanent link">&para;</a></h3>
<p>Angular Material unterstützt die Erstellung von <a href="https://material.angular.io/components/dialog/overview">Dialogen</a>. Um die Material-Dialoge verwenden zu können, müssen wir diese in der <code>app.module.ts</code>  (darin auch schon die <code>ExistDialogComponent</code>, die wir gleich erstellen):</p>
<div class="tabbed-set" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><label for="__tabbed_14_1">app.module.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">AppRoutingModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app-routing.module&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./app.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserAnimationsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/platform-browser/animations&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NavComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./nav/nav.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LayoutModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/cdk/layout&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatToolbarModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/toolbar&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatButtonModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/button&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatSidenavModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/sidenav&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatIconModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/icon&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatListModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/list&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RegisterComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatInputModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/input&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatSelectModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/select&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatRadioModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/radio&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatCardModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/card&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ReactiveFormsModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LoginComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HomeComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./home/home.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatGridListModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/grid-list&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatMenuModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/menu&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">MatDialogModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/dialog&#39;</span><span class="p">;</span>
</span><span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClientModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ExistDialogComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/exist-dialog/exist-dialog.component&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">declarations</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span><span class="p">,</span>
    <span class="nx">NavComponent</span><span class="p">,</span>
    <span class="nx">RegisterComponent</span><span class="p">,</span>
    <span class="nx">LoginComponent</span><span class="p">,</span>
    <span class="nx">HomeComponent</span><span class="p">,</span>
    <span class="nx">ExistDialogComponent</span>
  <span class="p">],</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">AppRoutingModule</span><span class="p">,</span>
    <span class="nx">BrowserAnimationsModule</span><span class="p">,</span>
    <span class="nx">LayoutModule</span><span class="p">,</span>
    <span class="nx">MatToolbarModule</span><span class="p">,</span>
    <span class="nx">MatButtonModule</span><span class="p">,</span>
    <span class="nx">MatSidenavModule</span><span class="p">,</span>
    <span class="nx">MatIconModule</span><span class="p">,</span>
    <span class="nx">MatListModule</span><span class="p">,</span>
    <span class="nx">MatInputModule</span><span class="p">,</span>
    <span class="nx">MatSelectModule</span><span class="p">,</span>
    <span class="nx">MatRadioModule</span><span class="p">,</span>
    <span class="nx">MatCardModule</span><span class="p">,</span>
    <span class="nx">ReactiveFormsModule</span><span class="p">,</span>
    <span class="nx">MatGridListModule</span><span class="p">,</span>
    <span class="nx">MatMenuModule</span><span class="p">,</span>
<span class="hll">    <span class="nx">MatDialogModule</span><span class="p">,</span>
</span>    <span class="nx">HttpClientModule</span>
  <span class="p">],</span>
  <span class="nx">providers</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">bootstrap</span><span class="o">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wir erstellen uns einen einfachen Dialog für die Nachricht, dass die E-Mail-Adresse bereits existiert. Dazu erstellen wir eine weitere einfache Komponente, die wir im <code>register</code>-Ordner erstellen:</p>
<div class="highlight"><pre><span></span><code>ng g c register/exist-dialog
</code></pre></div>
<p>Die <code>exist-dialog.component.ts</code> können wir kleinstmöglich gestalten: </p>
<div class="tabbed-set" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><label for="__tabbed_15_1">register/exist-dialog.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-exist-dialog&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./exist-dialog.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./exist-dialog.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ExistDialogComponent</span> <span class="p">{}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Für die <code>exist-dialog.component.html</code> bedienen wir uns aus den <a href="https://material.angular.io/components/dialog/examples">Material-Dialog-Beispielen</a> :</p>
<div class="tabbed-set" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><label for="__tabbed_16_1">register/exist-dialog.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h2</span> <span class="na">mat-dialog-title</span><span class="p">&gt;</span>E-Mail bereits verwendet<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">mat-dialog-content</span><span class="p">&gt;</span>
    Diese E-Mail ist bereits registriert!
<span class="p">&lt;/</span><span class="nt">mat-dialog-content</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">mat-dialog-actions</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-button</span> <span class="na">mat-dialog-close</span><span class="p">&gt;</span>Ok<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">mat-dialog-actions</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Nun können wir in der <code>register.component.ts</code> die <code>openDialog()</code>-Funktion implementieren. Wir zeigen die vollständige Datei (inkl. <code>onSubmit()</code>):</p>
<div class="tabbed-set" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><label for="__tabbed_17_1">register.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ExistDialogComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./exist-dialog/exist-dialog.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AbstractControl</span><span class="p">,</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">ValidationErrors</span><span class="p">,</span> <span class="nx">ValidatorFn</span><span class="p">,</span> <span class="nx">Validators</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MatDialog</span><span class="p">,</span> <span class="nx">MatDialogConfig</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/material/dialog&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BackendService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/backend.service&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/user&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-register&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./register.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./register.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RegisterComponent</span> <span class="p">{</span>
  <span class="nx">hide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">user</span><span class="o">!:</span> <span class="nx">User</span><span class="p">;</span>

  <span class="nx">checkPasswords</span><span class="o">:</span> <span class="nx">ValidatorFn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">group</span><span class="o">:</span> <span class="nx">AbstractControl</span><span class="p">)</span><span class="o">:</span>  <span class="nx">ValidationErrors</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">pass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="o">?</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">confirmPass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="o">?</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;passwordrepeat&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span>
    <span class="k">return</span> <span class="nx">pass</span> <span class="o">===</span> <span class="nx">confirmPass</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">notSame</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">registerForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
    <span class="nx">firstName</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">lastName</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">email</span><span class="p">]],</span>
    <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">compose</span><span class="p">([</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">,</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">pattern</span><span class="p">(</span><span class="s1">&#39;^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$&#39;</span><span class="p">),</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">minLength</span><span class="p">(</span><span class="mf">8</span><span class="p">),</span>
      <span class="nx">Validators</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">(</span><span class="mf">20</span><span class="p">)])</span>
    <span class="p">],</span>
    <span class="nx">passwordrepeat</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">],</span>
    <span class="nx">role</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
  <span class="p">},</span> <span class="p">{</span> <span class="nx">validators</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkPasswords</span> <span class="p">});</span>

  <span class="nx">roles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Admin&#39;</span><span class="p">,</span> <span class="nx">abbreviation</span><span class="o">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nx">abbreviation</span><span class="o">:</span> <span class="s1">&#39;user&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">bs</span><span class="o">:</span> <span class="nx">BackendService</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">dialog</span><span class="o">:</span> <span class="nx">MatDialog</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">firstname</span><span class="o">:</span> <span class="nx">values</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
      <span class="nx">lastname</span><span class="o">:</span> <span class="nx">values</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nx">values</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
    <span class="nx">role</span><span class="o">:</span> <span class="nx">values</span><span class="p">.</span><span class="nx">role</span>
    <span class="p">};</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;user : &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bs</span><span class="p">.</span><span class="nx">registerNewUser</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">openDialog</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">dialogConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MatDialogConfig</span><span class="p">();</span>

        <span class="nx">dialogConfig</span><span class="p">.</span><span class="nx">disableClose</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">dialogConfig</span><span class="p">.</span><span class="nx">autoFocus</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">ExistDialogComponent</span><span class="p">,</span> <span class="nx">dialogConfig</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="nx">checkIfExists</span><span class="p">(</span><span class="nx">evt</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">email</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;event-target&#39;</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">email</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bs</span><span class="p">.</span><span class="nx">checkIfExist</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">openDialog</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>
      <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Angenommen, wir geben nun eine E-Mail-Adresse in das Registrierungs-Formular ein, die bereits existiert, dann erscheint eine Nachricht:</p>
<p><img alt="user" src="../files/242_user.png" /></p>
<h3 id="registrierung-neue-nutzerin">Registrierung neue Nutzerin<a class="headerlink" href="#registrierung-neue-nutzerin" title="Permanent link">&para;</a></h3>
<p>Für die Registrierung einer neuen Nutzerin wird die <code>registerNewUser(user: User)</code>-Funktion aus dem <code>BackendService</code> in der <code>onSubmit()</code>-Funktion in der <code>register.component.ts</code> aufgerufen. Beide Funktionen sind bereits oben gezeigt. Auch hier könnte ein Bestätigungsdialog erstellt werden. </p>
<h2 id="login">Login<a class="headerlink" href="#login" title="Permanent link">&para;</a></h2>
<p>Nachdem eine Nutzerin registriert ist, kann sie sich einloggen. Wir passen dazu die <code>LoginComponent</code> an. Wir erstellen uns erneut ein <em>reaktives Formular</em> mit den Einwahldaten <code>email</code> und <code>password</code>:</p>
<div class="tabbed-set" data-tabs="18:3"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><label for="__tabbed_18_1">login.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">Validators</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BackendService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/backend.service&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-login&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./login.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./login.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">LoginComponent</span> <span class="p">{</span>
  <span class="nx">hide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nx">loginForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
    <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">bs</span><span class="o">:</span> <span class="nx">BackendService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="c1">// Absenden des Formulars - kommt gleich</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
<input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><label for="__tabbed_18_2">login.component.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="err">[</span><span class="na">formGroup</span><span class="err">]=&quot;</span><span class="na">loginForm</span><span class="err">&quot;</span> <span class="na">novalidate</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)=&quot;</span><span class="na">onSubmit</span><span class="err">()&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">mat-card</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;shipping-card&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-header</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">mat-card-title</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">mat-card-title</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-header</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-content</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>E-Mail<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;E-Mail&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-error</span> <span class="err">*</span><span class="na">ngIf</span><span class="o">=</span><span class="s">&quot;loginForm.controls[&#39;email&#39;].hasError(&#39;required&#39;)&quot;</span><span class="p">&gt;</span>
                        E-Mail <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>erforderlich<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">mat-error</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">mat-form-field</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;full-width&quot;</span> <span class="na">appearance</span><span class="o">=</span><span class="s">&quot;standard&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">mat-label</span><span class="p">&gt;</span>Passwort<span class="p">&lt;/</span><span class="nt">mat-label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">matInput</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Passwort&quot;</span> <span class="na">formControlName</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="err">[</span><span class="na">type</span><span class="err">]=&quot;</span><span class="na">hide</span> <span class="err">?</span> <span class="err">&#39;</span><span class="na">password</span><span class="err">&#39;</span> <span class="na">:</span> <span class="err">&#39;</span><span class="na">text</span><span class="err">&#39;&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-icon-button</span> <span class="na">matSuffix</span> <span class="err">(</span><span class="na">click</span><span class="err">)=&quot;</span><span class="na">hide </span><span class="o">=</span> <span class="s">!hide&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-label</span><span class="err">]=&quot;&#39;</span><span class="na">Hide</span> <span class="na">password</span><span class="err">&#39;&quot;</span> <span class="err">[</span><span class="na">attr</span><span class="err">.</span><span class="na">aria-pressed</span><span class="err">]=&quot;</span><span class="na">hide</span><span class="err">&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">mat-icon</span><span class="p">&gt;</span>{{hide ? &#39;visibility_off&#39; : &#39;visibility&#39;}}<span class="p">&lt;/</span><span class="nt">mat-icon</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">mat-form-field</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-content</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">mat-card-actions</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">mat-raised-button</span> <span class="na">color</span><span class="o">=</span><span class="s">&quot;primary&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">mat-card-actions</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">mat-card</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
</div>
<input id="__tabbed_18_3" name="__tabbed_18" type="radio" /><label for="__tabbed_18_3">login.component.css</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">mat-card</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">%</span> <span class="mi">20</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">full-width</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Die <code>LoginComponent</code> sieht dann so aus:</p>
<p><img alt="user" src="../files/243_user.png" /></p>
<p>Jetzt passen wir noch den <code>BackendService</code> an. Dort wird der Endpunkt <code>POST http://localhost:3000/users/login/:email</code> verwendet, um zu überprüfen, ob die <code>email</code> existiert und das Passwort korrekt ist. Die entsprechende <code>loginUser()</code>-Funktion könnte so aussehen:</p>
<div class="tabbed-set" data-tabs="19:1"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><label for="__tabbed_19_1">backend.service.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClient</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/common/http&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;rxjs&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user&#39;</span><span class="p">;</span>

<span class="kd">@Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">BackendService</span> <span class="p">{</span>
  <span class="nx">userRoute</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:3000/users&#39;</span><span class="p">;</span>
  <span class="nx">memberRoute</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:3000/members&#39;</span><span class="p">;</span>

  <span class="kr">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">http</span>: <span class="kt">HttpClient</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">registerNewUser</span><span class="p">(</span><span class="nx">user</span>: <span class="kt">User</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userRoute</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">checkIfExist</span><span class="p">(</span><span class="nx">email</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userRoute</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">email</span><span class="p">);</span>
  <span class="p">}</span>

<span class="hll">  <span class="nx">loginUser</span><span class="p">(</span><span class="nx">email</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">password</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">{</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">userRoute</span><span class="o">+</span> <span class="s1">&#39;/login/&#39;</span> <span class="o">+</span> <span class="nx">email</span><span class="p">,</span> <span class="p">{</span> <span class="nx">password</span>: <span class="kt">password</span> <span class="p">});</span>
</span><span class="hll">  <span class="p">}</span>
</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Nun implementieren wir nur noch die <code>onSubmit()</code>-Funktion in der <code>login.component.ts</code>, um die eingegebenen Daten korrekt an das Backend zu senden und mit der <code>response</code> vernünftig umzugehen:</p>
<div class="tabbed-set" data-tabs="20:1"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><label for="__tabbed_20_1">login.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="nx">Validators</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BackendService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/backend.service&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span> <span class="s1">&#39;app-login&#39;</span><span class="p">,</span>
  <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;./login.component.html&#39;</span><span class="p">,</span>
  <span class="nx">styleUrls</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;./login.component.css&#39;</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">LoginComponent</span> <span class="p">{</span>
  <span class="nx">hide</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nx">loginForm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
    <span class="nx">email</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">],</span>
    <span class="nx">password</span><span class="o">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">Validators</span><span class="p">.</span><span class="nx">required</span><span class="p">]</span>
  <span class="p">});</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span> <span class="kr">private</span> <span class="nx">bs</span><span class="o">:</span> <span class="nx">BackendService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">password</span> <span class="o">=</span>  <span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">bs</span><span class="p">.</span><span class="nx">loginUser</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span><span class="nx">response</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error status&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error error message&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Es gibt zwei Möglichkeiten: </p>
<ol>
<li>Entweder die <code>email</code> existiert und das <code>password</code> ist korrekt. Dann besteht die <code>response</code> aus dem gesamten <code>User</code>-Datensatz (also <code>firstname</code>, <code>lastname</code>, <code>role</code> usw.). Das ist der <code>response</code>-Fall in der <code>subscribe()</code>-Funktion. </li>
<li>Oder das Backend sendet einen <code>403</code>-Status in einem <code>HttpErrorResponse</code>-Objekt zurück. Das ist der <code>error</code>-Fall in der <code>subscribe()</code>-Funktion. </li>
</ol>
<p>Je nachdem, ist die Nutzerin danach eingelogged oder nicht. Wir wollen in einem weiteren Service verwalten, ob eine Nutzerin eingelogged ist und wenn ja, dann in welcher Rolle. </p>
<h2 id="authentisierungs-service">Authentisierungs-Service<a class="headerlink" href="#authentisierungs-service" title="Permanent link">&para;</a></h2>
<p>In dem <a href="../routing/#routing-und-services">Routing</a>-Abschnitt haben wir auch <a href="../routing/#routen-absichern-mit-guards">Guards</a> kennengelernt. Darin ahtten wir auch bereits einen einfachen <code>AuthService</code> erstellt, der damals noch nur ein Dummy-Funktion hatte, um das Eingeloggtsein zu simulieren. Einen solchen <code>AuthService</code> wollen wir nun auf Basis der Login-Informationen erweiteren und für unsere <em>Guards</em>  verwenden.  Dazu erstellen wir uns einen solchen Service:</p>
<div class="highlight"><pre><span></span><code>ng g service shared/auth
</code></pre></div>
<p>Der <code>AuthService</code> sieht zunächst wie folgt aus:</p>
<div class="tabbed-set" data-tabs="21:1"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><label for="__tabbed_21_1">shared/auth.service.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./user&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthService</span> <span class="p">{</span>
  <span class="nx">user</span><span class="o">!:</span> <span class="nx">User</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">loggedIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{}</span>

  <span class="nx">isAuthenticated</span><span class="p">()</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loggedIn</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">login</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span> <span class="nx">User</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loggedIn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">logout</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loggedIn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getUser</span><span class="p">()</span><span class="o">:</span> <span class="nx">User</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">isAdmin</span><span class="p">()</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">isUser</span><span class="p">()</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wir haben einige Objektvariablen und Objektfunktionen erstellt, um zu verwalten, ob eine Nutzerin eingelogged ist und welche Rolle sie hat. Am Anfang ist <code>loggedIn = false</code> und <code>user = null</code>. Wir werden nun in der <code>LoginComponent</code> diesen Service einbinden und die Funktionen entsprechend aufrufen:</p>
<div class="tabbed-set" data-tabs="22:1"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><label for="__tabbed_22_1">Auszug aus login.component.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="nx">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">fb</span><span class="o">:</span> <span class="nx">FormBuilder</span><span class="p">,</span> 
    <span class="kr">private</span> <span class="nx">bs</span><span class="o">:</span> <span class="nx">BackendService</span><span class="p">,</span> 
<span class="hll">    <span class="kr">private</span> <span class="nx">auth</span><span class="o">:</span> <span class="nx">AuthService</span>
</span>  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">onSubmit</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loginForm</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">password</span> <span class="o">=</span>  <span class="nx">values</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">bs</span><span class="p">.</span><span class="nx">loginUser</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(</span>
        <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span><span class="nx">response</span><span class="p">);</span>
<span class="hll">          <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span>        <span class="p">},</span>
        <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error status&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error error message&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
<span class="hll">          <span class="k">this</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>
</span>        <span class="p">})</span>
  <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wenn das Login erfolgreich war, dann ist nun <code>user</code> im <code>AuthService</code> mit einem konkreten Objekt belegt und kann ausgelsen werden. Dazu sind ja bereits einige Funktionen im <code>AuthService</code> vorgesehen. Wir werden diese Funktionen nun in einem <em>Guard</em> verwenden, mit dem wir den Zugriff auf die Komponenten steuern. </p>
<h2 id="guards-fur-den-komponentenzugriff">Guards für den Komponentenzugriff<a class="headerlink" href="#guards-fur-den-komponentenzugriff" title="Permanent link">&para;</a></h2>
<p>In <a href="../routing/#routen-absichern-mit-guards">Routen absichern mit Guards</a> haben wir bereits die Grundidee von <em>Guards</em> vorgestellt. Wir wollen diese hier anwenden und beschränken uns dabei auf den <em>Guard-Typ</em> <code>CanActivate</code>. Wir wollen sicherstellen, dass die <code>HomeComponent</code> nur aktiviert werden kann, wenn man eingelogged ist und die <code>RegisterComponent</code> nur dann, wenn man als <code>admin</code> eingelogged ist, um das Prinzip zu verdeutlichen. Wir erstellen uns also einen <code>CanActivate</code>-Guard (im Ordner <code>guards</code>):</p>
<div class="highlight"><pre><span></span><code>ng g guard guards/authguard --implements CanActivate
</code></pre></div>
<p>Diesen <code>AuthGuard</code> implementieren wir wie folgt: </p>
<div class="tabbed-set" data-tabs="23:1"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><label for="__tabbed_23_1">guards/authguard.guards.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span> <span class="nx">CanActivate</span><span class="p">,</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">RouterStateSnapshot</span><span class="p">,</span> <span class="nx">UrlTree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/auth.service&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AuthguardGuard</span> <span class="nx">implements</span> <span class="nx">CanActivate</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">as</span><span class="o">:</span> <span class="nx">AuthService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">router</span><span class="o">:</span> <span class="nx">Router</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">canActivate</span><span class="p">(</span>
    <span class="nx">route</span><span class="o">:</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span>
    <span class="nx">state</span><span class="o">:</span> <span class="nx">RouterStateSnapshot</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="nx">UrlTree</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">as</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">()</span>
      <span class="o">?</span> <span class="kc">true</span>
      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">parseUrl</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Dieser <em>Guard</em> gibt bei Aufruf der <code>canActivate()</code>-Funktion ein <code>true</code> zurück, wenn eine Nutzerin eingelogged ist (<code>isAuthenticated()</code> aus dem <code>AuthService</code>). Wenn niemand eingelogged ist, (wenn also <code>isAuthentivacated()</code> ein <code>false</code> zurückgibt), dann wird die aktuelle Route nach <code>/login</code> umgeleitet. Wir fügen diesen Guard nun in die <code>app-routing.module.ts</code> ein:</p>
<div class="tabbed-set" data-tabs="24:1"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><label for="__tabbed_24_1">app-routing.module.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RouterModule</span><span class="p">,</span> <span class="nx">Routes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">AuthguardGuard</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./guards/authguard.guard&#39;</span><span class="p">;</span>
</span><span class="k">import</span> <span class="p">{</span> <span class="nx">HomeComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./home/home.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LoginComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RegisterComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">routes</span><span class="o">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">HomeComponent</span><span class="p">,</span>
<span class="hll">  <span class="nx">canActivate</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthguardGuard</span><span class="p">]</span>
</span><span class="p">},</span>
<span class="p">{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">LoginComponent</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">RegisterComponent</span><span class="p">,</span>
<span class="hll">  <span class="nx">canActivate</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthguardGuard</span><span class="p">]</span>
</span><span class="p">}];</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">)],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppRoutingModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wenn wir nun die Anwendung öffnen, dann kommen wir weder auf die <code>HomeComponent</code>, noch auf die <code>RegisterComponent</code>, sondern werden stets zur <code>LoginComponent</code> geleitet. Erst wenn wir eingelogged sind, sind die beiden Komponenten erreichbar. </p>
<p>Wir erstellen noch einen weiteren Guard, um auch abzuprüfen, ob wir als <code>admin</code> eingelogged sind und wollen mit diesem Guard die <code>RegisterComponent</code> sichern. </p>
<div class="highlight"><pre><span></span><code>ng g guard guards/adminguard --implements CanActivate
</code></pre></div>
<div class="tabbed-set" data-tabs="25:1"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><label for="__tabbed_25_1">guards/adminguard.guards.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span> <span class="nx">CanActivate</span><span class="p">,</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">RouterStateSnapshot</span><span class="p">,</span> <span class="nx">UrlTree</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AuthService</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../shared/auth.service&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Injectable</span><span class="p">({</span>
  <span class="nx">providedIn</span><span class="o">:</span> <span class="s1">&#39;root&#39;</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AdminguardGuard</span> <span class="nx">implements</span> <span class="nx">CanActivate</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span>
    <span class="kr">private</span> <span class="nx">as</span><span class="o">:</span> <span class="nx">AuthService</span><span class="p">,</span>
    <span class="kr">private</span> <span class="nx">router</span><span class="o">:</span> <span class="nx">Router</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">canActivate</span><span class="p">(</span>
    <span class="nx">route</span><span class="o">:</span> <span class="nx">ActivatedRouteSnapshot</span><span class="p">,</span>
    <span class="nx">state</span><span class="o">:</span> <span class="nx">RouterStateSnapshot</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="o">|</span> <span class="nx">UrlTree</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">as</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">()</span>
      <span class="o">?</span> <span class="kc">true</span>
      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">parseUrl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Dieses Mal wird geprüft, ob die Nutzerin eingelogged <strong>und</strong> in der <code>admin</code>-Rolle ist. Diesen Guard fügen wir der <code>/register</code>-Route hinzu. Nur ein <code>admin</code> darf Registrierungen vornehmen (wird hier exemplarisch angenommen).</p>
<div class="tabbed-set" data-tabs="26:1"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><label for="__tabbed_26_1">app-routing.module.ts</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RouterModule</span><span class="p">,</span> <span class="nx">Routes</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="hll"><span class="k">import</span> <span class="p">{</span> <span class="nx">AuthguardGuard</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./guards/authguard.guard&#39;</span><span class="p">;</span>
</span><span class="k">import</span> <span class="p">{</span> <span class="nx">HomeComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./home/home.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LoginComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./login/login.component&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RegisterComponent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./register/register.component&#39;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">routes</span><span class="o">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">HomeComponent</span><span class="p">,</span>
<span class="hll">  <span class="nx">canActivate</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthguardGuard</span><span class="p">]</span>
</span><span class="p">},</span>
<span class="p">{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">LoginComponent</span>
<span class="p">},</span>
<span class="p">{</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;register&#39;</span><span class="p">,</span>
  <span class="nx">component</span><span class="o">:</span> <span class="nx">RegisterComponent</span><span class="p">,</span>
<span class="hll">  <span class="nx">canActivate</span><span class="o">:</span> <span class="p">[</span><span class="nx">AuthguardGuard</span><span class="p">]</span>
</span><span class="p">}];</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="nx">imports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">)],</span>
  <span class="nx">exports</span><span class="o">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppRoutingModule</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wenn nun eine <code>admin</code>-Userin eingelogged ist, kann sie die <code>HomeComponent</code>, die <code>RegisterComponent</code> und die <code>LoginComponent</code> öffnen. Ist eine <code>user</code>-Userin eingelogged, hat sie keinen Zugriff auf die <code>RegisterComponent</code>, sondern nur auf die <code>LoginComponent</code> und die <code>HomeComponent</code>. Ist niemand eingelogged, kann nur die <code>LoginComponent</code> verwendet werden. </p>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben eine (sehr einfache) Nutzerverwaltung implementiert. Eine Nutzerin kann sich registrieren und einloggen. Die Registrierungsdaten werden in der Datenbank gespeichert. Das Passwort wird verschlüsselt abgelegt. Jeder Nutzerin kann eine Rolle zugewiesen werden. Abhängig davon, ob jemand eingelogged ist bzw. in welcher Rolle sind die Komponenten unterschiedlich erreichbar. Dies wurde mit Guards realisiert. Für das Layout wurde Angular Material verwendet. Die Nutzerverwaltung ist noch sehr rudimentär. Es fehlt z.B. noch das Ausloggen. Es wäre auch gut, wenn die Nutzerin nach der Registrierung oder nach dem Einloggen eine entsprechende Erfolgsnachricht bekäme und z.B. auf die Home- oder die Login-Komponente weitergelitet würde. Die Konzepte für eine Dialoggestaltung, für die Erweitereung und Anbindung des Backends sowie für eine Weitereleitung auf eine ander Komponente wurden jedoch alle exemplarisch gezeigt.  </p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../fe-be-anbindung/" class="md-footer__link md-footer__link--prev" aria-label="Zurück: Frontend-Backend-Anbindung" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Zurück
              </span>
              Frontend-Backend-Anbindung
            </div>
          </div>
        </a>
      
      
        
        <a href="../dateiupload/" class="md-footer__link md-footer__link--next" aria-label="Weiter: Dateiupload" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Weiter
              </span>
              Dateiupload
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Jörn Freiheit
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking"], "translations": {"clipboard.copy": "In Zwischenablage kopieren", "clipboard.copied": "In Zwischenablage kopiert", "search.config.lang": "de", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Suche", "search.result.placeholder": "Suchbegriff eingeben", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.term.missing": "Es fehlt", "select.version.title": "Version ausw\u00e4hlen"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>